# ISLAMIC INHERITANCE SPEC DSL

## Version: 1.0 (Complete, Sunni-General, Configurable Ikhtilaf)

---

## SECTION 0 — GLOBAL DEFINITIONS

```spec
ESTATE:
  gross_estate
  debts
  funeral_costs
  wasiyyah

NET_ESTATE_RULE:
  net_estate = gross_estate - debts - funeral_costs - allowed_wasiyyah

WASIYYAH_RULE:
  allowed_wasiyyah = MIN(wasiyyah, (gross_estate - debts - funeral_costs) * 1/3)
  OVERRIDE_IF wasiyyah_approved_by_heirs == true

ERROR_IF net_estate < 0:
  ACTION = POLICY(net_estate_negative_handling)
```

---

## SECTION 1 — HEIR TYPES (ENUM CANONICAL)

```spec
HEIR_TYPES:

  SPOUSE:
    HUSBAND
    WIFE

  ASCENDANTS:
    FATHER
    MOTHER
    GRANDFATHER_PATERNAL
    GRANDMOTHER_MATERNAL
    GRANDMOTHER_PATERNAL

  DESCENDANTS:
    SON
    DAUGHTER
    GRANDSON_SON
    GRANDDAUGHTER_SON

  SIBLINGS:
    BROTHER_FULL
    SISTER_FULL
    BROTHER_PATERNAL
    SISTER_PATERNAL
    BROTHER_UTERINE
    SISTER_UTERINE

  EXTENDED_ASABAH:
    NEPHEW_FULL
    NEPHEW_PATERNAL
    UNCLE_FULL
    UNCLE_PATERNAL
    COUSIN_FULL
    COUSIN_PATERNAL

  DHAWIL_ARHAM:
    GRANDCHILD_DAUGHTER
    AUNT_MATERNAL
    AUNT_PATERNAL
    UNCLE_MATERNAL
    OTHER_DHAWIL_ARHAM
```

---

## SECTION 2 — DERIVED CONDITIONS (BOOLEAN FLAGS)

```spec
FLAGS:

  HAS_CHILD          = (SON + DAUGHTER) > 0
  HAS_SON            = SON > 0
  HAS_DAUGHTER       = DAUGHTER > 0

  HAS_GRANDSON       = GRANDSON_SON > 0
  HAS_DESCENDANT     = HAS_CHILD OR HAS_GRANDSON

  HAS_FATHER         = FATHER > 0
  HAS_MOTHER         = MOTHER > 0

  HAS_GRANDFATHER    = GRANDFATHER_PATERNAL > 0

  HAS_SIBLINGS_TOTAL =
      BROTHER_FULL +
      SISTER_FULL +
      BROTHER_PATERNAL +
      SISTER_PATERNAL +
      BROTHER_UTERINE +
      SISTER_UTERINE

  HAS_TWO_OR_MORE_SIBLINGS = HAS_SIBLINGS_TOTAL >= 2
```

---

## SECTION 3 — POLICY SWITCHES (IKHTILAF CONFIG)

```spec
POLICIES:

  RADD_INCLUDES_SPOUSE = false | true
  GRANDFATHER_MODE    = LIKE_FATHER | COMPETE_WITH_SIBLINGS
  DHAWIL_ARHAM_MODE   = ENABLED | BAITUL_MAL
  MOTHER_SIBLING_RULE = COUNT_ALL | EXCLUDE_UTERINE
```

---

## SECTION 4 — HIJAB HIRMAN (TOTAL EXCLUSION RULES)

```spec
HIJAB_HIRMAN_RULES:

  RULE E1:
    IF HAS_DESCENDANT == true
    THEN EXCLUDE:
      BROTHER_FULL
      SISTER_FULL
      BROTHER_PATERNAL
      SISTER_PATERNAL
      BROTHER_UTERINE
      SISTER_UTERINE

  RULE E2:
    IF HAS_FATHER == true
    THEN EXCLUDE:
      GRANDFATHER_PATERNAL
      BROTHER_FULL
      BROTHER_PATERNAL
      NEPHEW_FULL
      NEPHEW_PATERNAL
      UNCLE_FULL
      UNCLE_PATERNAL
      COUSIN_FULL
      COUSIN_PATERNAL

  RULE E3:
    IF HAS_SON == true
    THEN EXCLUDE:
      GRANDSON_SON
      GRANDDAUGHTER_SON

  RULE E4:
    IF HAS_MOTHER == true
    THEN EXCLUDE:
      GRANDMOTHER_MATERNAL

  RULE E5:
    IF HAS_FATHER == true
    THEN EXCLUDE:
      GRANDMOTHER_PATERNAL

  RULE E6:
    IF BROTHER_FULL > 0
    THEN EXCLUDE:
      BROTHER_PATERNAL
      SISTER_PATERNAL

  RULE E7:
    IF BROTHER_PATERNAL > 0
    THEN EXCLUDE:
      NEPHEW_FULL
      NEPHEW_PATERNAL
```

---

## SECTION 5 — FURUDH (FIXED SHARE RULES)

### 5.1 SPOUSE

```spec
FURUDH_SPOUSE:

  HUSBAND:
    IF HAS_DESCENDANT == false THEN SHARE = 1/2
    IF HAS_DESCENDANT == true  THEN SHARE = 1/4

  WIFE:
    IF HAS_DESCENDANT == false THEN SHARE = 1/4
    IF HAS_DESCENDANT == true  THEN SHARE = 1/8
    DISTRIBUTE_EQUALLY
```

---

### 5.2 MOTHER

```spec
FURUDH_MOTHER:

  SPECIAL_CASE UMARIYATAYN:
    IF (HUSBAND OR WIFE) AND FATHER AND MOTHER AND HAS_DESCENDANT == false
    THEN SHARE = 1/3 OF REMAINDER

  GENERAL_RULE:
    IF HAS_DESCENDANT == true THEN SHARE = 1/6
    ELSE IF HAS_TWO_OR_MORE_SIBLINGS == true THEN SHARE = 1/6
    ELSE SHARE = 1/3
```

---

### 5.3 FATHER

```spec
FURUDH_FATHER:

  IF HAS_DESCENDANT == false
    THEN ASABAH = true

  IF HAS_SON == true
    THEN SHARE = 1/6

  IF HAS_DESCENDANT == true AND HAS_SON == false
    THEN SHARE = 1/6
    AND ASABAH = true
```

---

### 5.4 DAUGHTERS

```spec
FURUDH_DAUGHTERS:

  IF HAS_SON == true
    THEN ASABAH_BIL_GHAYR = true
    RATIO = MALE:2 FEMALE:1

  ELSE IF DAUGHTER == 1
    THEN SHARE = 1/2

  ELSE IF DAUGHTER >= 2
    THEN SHARE = 2/3
```

---

### 5.5 GRANDDAUGHTER (SON'S DAUGHTER)

```spec
FURUDH_GRANDDAUGHTER:

  IF HAS_SON == true
    THEN EXCLUDED

  IF HAS_DAUGHTER >= 2
    THEN EXCLUDED

  IF HAS_DAUGHTER == 1
    THEN SHARE = 1/6

  IF GRANDSON_SON > 0
    THEN ASABAH_BIL_GHAYR = true
```

---

### 5.6 UTERINE SIBLINGS

```spec
FURUDH_UTERINE_SIBLINGS:

  IF HAS_DESCENDANT == true OR HAS_FATHER == true
    THEN EXCLUDED

  IF COUNT == 1
    THEN SHARE = 1/6

  IF COUNT >= 2
    THEN SHARE = 1/3
```

---

## SECTION 6 — ASABAH RULES (REMAINDER HEIRS)

```spec
ASABAH_ORDER:

  1. SON
  2. GRANDSON_SON
  3. FATHER
  4. GRANDFATHER_PATERNAL (POLICY: GRANDFATHER_MODE)
  5. BROTHER_FULL
  6. BROTHER_PATERNAL
  7. NEPHEW_FULL
  8. NEPHEW_PATERNAL
  9. UNCLE_FULL
 10. UNCLE_PATERNAL
 11. COUSIN_FULL
 12. COUSIN_PATERNAL
```

### Asabah Types

```spec
ASABAH_BIL_GHAYR:
  FEMALE + MALE SAME_LEVEL
  RATIO = MALE:2 FEMALE:1

ASABAH_MAAL_GHAYR:
  SISTER_FULL OR SISTER_PATERNAL
  IF DAUGHTER OR GRANDDAUGHTER EXISTS
```

---

## SECTION 7 — AUL (OVER-SUBSCRIPTION)

```spec
AUL_RULE:

  IF TOTAL_FURUDH > 1
  THEN FOR EACH FURUDH:
    adjusted_share = share / TOTAL_FURUDH
  NO_REMAINDER
```

---

## SECTION 8 — RADD (RETURN OF REMAINDER)

```spec
RADD_RULE:

  IF TOTAL_FURUDH < 1 AND NO_ASABAH_EXISTS
  THEN DISTRIBUTE REMAINDER TO:
    ALL_FURUDH_HOLDERS
    EXCEPT SPOUSE IF RADD_INCLUDES_SPOUSE == false
```

---

## SECTION 9 — DHAWIL ARHAM (FINAL FALLBACK)

```spec
DHAWIL_ARHAM_RULE:

  IF NO_FURUDH AND NO_ASABAH
  THEN
    IF DHAWIL_ARHAM_MODE == ENABLED
      DISTRIBUTE_ACCORDING_TO_ARHAM_ORDER
    ELSE
      ASSIGN_TO_BAITUL_MAL
```

---

## SECTION 10 — FINAL CONSISTENCY

```spec
FINAL_RULES:

  SUM(all_shares) == 1.0

  MONEY_DISTRIBUTION:
    APPLY_ROUNDING_POLICY
    ENSURE sum(amounts) == net_estate
```

---

## PENUTUP — STATUS DOKUMEN

* ✅ **Lengkap (semua kategori waris utama)**
* ✅ **Deterministik**
* ✅ **Agnostic bahasa**
* ✅ **Siap dijadikan rule engine**
* ✅ **Ikhtilaf configurable**
* ✅ **Trace-friendly**
